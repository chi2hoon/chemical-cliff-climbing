file: base/data/bronze/artifacts/2018_raw.xlsx
read: {dtype: str, engine: openpyxl}
sheets:
  - name: "Sheet1"
    tables:
      - id: main
        range: "A1:G459"
        header_row_offset: 0
        rename:
          Num: compound_id
          smiles: smiles_raw
          iupacs: iupac_name
        clean:
          replace: {"-": null, "": null, "n.d.": null, "n.d": null, "N.D.": null, "ND": null, "N/A": null, "n/a": null}
        normalize_rules:
          "KRAS-SOS1 Interaction":
            - "([\\d\\.]+)TE([+-]?\\d+) -> \\1E\\2"
          "KRAS-Activation by SOS high GTP":
            - "([\\d\\.]+)TE([+-]?\\d+) -> \\1E\\2"
          "KRAS-Activation by SOS no GTP":
            - "([\\d\\.]+)TE([+-]?\\d+) -> \\1E\\2"
          "EGFR kinase inhibition IC50":
            - "([\\d\\.]+)TE([+-]?\\d+) -> \\1E\\2"
        melt:
          id_cols: [compound_id, iupac_name, smiles_raw, provenance_file, provenance_sheet, provenance_row]
          value_cols: ["KRAS-SOS1 Interaction", "KRAS-Activation by SOS high GTP", "KRAS-Activation by SOS no GTP", "EGFR kinase inhibition IC50"]

silver:
  compounds:
    from: base/data/bronze/2018/tables/main.csv
  assays:
    from_melt: main_long
    variable_rules:
      KRAS-SOS1 Interaction:
        target_id: kras_sos1
        assay_id: cell.cytotoxicity.ic50
        parse:
          default_unit: uM
          rules:
            # % 억제(20 uM) 표기
            - '^\s*([\\d\\.]+)\s*%\s*$ -> qualifier:=, value:\\1, unit:%'
            # % 억제(소수 표기: 0.44 = 44%)
            - '^\s*0?\\.\\d+\s*$ -> qualifier:=, value:\0, unit:%'
            # µM / uM / nM 표기(부등호 포함)
            - '>=?\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*µ?M\s*$ -> qualifier:>, value:\\1, unit:uM'
            - '^\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*µ?M\s*$ -> qualifier:=, value:\\1, unit:uM'
            - '>=?\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*nM\s*$ -> qualifier:>, value:\\1, unit:nM'
            - '^\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*nM\s*$ -> qualifier:=, value:\\1, unit:nM'
            # 단위 미표기 숫자/과학표기법: 2018 특허 관행에 따라 기본 단위를 M로 해석
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*$ -> qualifier:>, value:\1, unit:M'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*$ -> qualifier:=, value:\1, unit:M'

      KRAS-Activation by SOS high GTP:
        target_id: kras_activation_high_gtp
        assay_id: cell.cytotoxicity.ic50
        parse:
          default_unit: uM
          rules:
            - '^\s*([\\d\\.]+)\s*%\s*$ -> qualifier:=, value:\\1, unit:%'
            - '^\s*0?\\.\\d+\s*$ -> qualifier:=, value:\0, unit:%'
            - '>=?\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*µ?M\s*$ -> qualifier:>, value:\\1, unit:uM'
            - '^\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*µ?M\s*$ -> qualifier:=, value:\\1, unit:uM'
            - '>=?\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*nM\s*$ -> qualifier:>, value:\\1, unit:nM'
            - '^\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*nM\s*$ -> qualifier:=, value:\\1, unit:nM'
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*$ -> qualifier:>, value:\1, unit:M'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*$ -> qualifier:=, value:\1, unit:M'

      KRAS-Activation by SOS no GTP:
        target_id: kras_activation_no_gtp
        assay_id: cell.cytotoxicity.ic50
        parse:
          default_unit: uM
          rules:
            - '^\s*([\\d\\.]+)\s*%\s*$ -> qualifier:=, value:\\1, unit:%'
            - '^\s*0?\\.\\d+\s*$ -> qualifier:=, value:\0, unit:%'
            - '>=?\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*µ?M\s*$ -> qualifier:>, value:\\1, unit:uM'
            - '^\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*µ?M\s*$ -> qualifier:=, value:\\1, unit:uM'
            - '>=?\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*nM\s*$ -> qualifier:>, value:\\1, unit:nM'
            - '^\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*nM\s*$ -> qualifier:=, value:\\1, unit:nM'
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*$ -> qualifier:>, value:\1, unit:M'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*$ -> qualifier:=, value:\1, unit:M'

      EGFR kinase inhibition IC50:
        target_id: egfr
        assay_id: cell.cytotoxicity.ic50
        parse:
          default_unit: uM
          rules:
            - '^\s*([\\d\\.]+)\s*%\s*$ -> qualifier:=, value:\\1, unit:%'
            - '^\s*0?\\.\\d+\s*$ -> qualifier:=, value:\0, unit:%'
            - '>=?\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*µ?M\s*$ -> qualifier:>, value:\\1, unit:uM'
            - '^\s*([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?)\s*µ?M\s*$ -> qualifier:=, value:\\1, unit:uM'
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*nM\s*$ -> qualifier:>, value:\1, unit:nM'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*nM\s*$ -> qualifier:=, value:\1, unit:nM'
            # pM 표기 지원(EGFR 등에서 관측): ASCII pM 그대로 유지
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*pM\s*$ -> qualifier:>, value:\1, unit:pM'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*pM\s*$ -> qualifier:=, value:\1, unit:pM'
            # 단위 미표기 숫자/과학표기법: 2018 특허 관행에 따라 기본 단위를 M로 해석
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*$ -> qualifier:>, value:\1, unit:M'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?)\s*$ -> qualifier:=, value:\1, unit:M'

  meta:
    # 20 uM 단일 농도에서의 % 억제만 선별 보존
    - from: base/data/bronze/2018/main_long.csv
      type: assay_context
      filter:
        percent_only: value
      inject:
        assay_id: cell.cytotoxicity.ic50
        concentration_uM: "20"
        context_label: percent_at_20uM
      parse:
        percent:
          col: value
          into: {percent_at_20uM: percent_at_20uM}
