file: base/data/bronze/artifacts/2020_raw.xlsx
read: {dtype: str, engine: openpyxl}
sheets:
  # (A) Intermediates & Building Blocks
  - name: "I-1 ~ I-64, BB-1 ~ BB-37"
    tables:
      - id: intermediates
        range: "A4:C106"     # 헤더행 포함, 데이터는 5행부터(A4 기준)
        header_row_offset: 0
        rename:
          "Compound No.": sample_label
          SMILES: smiles_raw
          "Analytics/Analytical Data": analytics_text
        clean:
          replace: {"": null, "-": null}

  # (B) Example 1~217 마스터
  - name: "Example 1 ~ Example 217"
    tables:
      - id: examples
        range: "A4:E222"
        header_row_offset: 0
        rename:
          "Compound No.": compound_label
          SMILES: smiles_raw
          "Starting Material": starting_material_1
          "Starting Material 2": starting_material_2
          Method: method
        clean:
          replace: {"": null, "-": null}

  # (C) Asterisk 예외 교정표
  - name: "Asterik ExceptionCase Chart"
    tables:
      - id: asterisk_exceptions
        range: "A3:D300"
        header_row_offset: 0
        rename:
          "OLD SMILES / Initial Extracted SMILES (with asterik/별표)": smiles_old
          "Yes/No": match_yes
          "NEW SMILES": smiles_new
        clean:
          replace: {"": null, "-": null}

  # (D) USP1 IC50 등급(표2~4 합본)
  - name: "Table 2 ~ 4"
    tables:
      - id: usp1_ic50_grades
        range: "A2:C240"
        header_row_offset: 0
        rename:
          "Table 2": sample_label
          SMILES: smiles_raw
          "USP1 IC_50": usp1_ic50_grade
        clean:
          replace: {"": null, "-": null}
        normalize_rules:
          sample_label:
            - "^Table\\s*\\d+\\s*$ -> ''"
          usp1_ic50_grade:
            # 엑셀에서 앞에 붙는 작은따옴표 제거 처리("'++" → "++")
            - "^'+(.*)$ -> \\1"
        melt:
          id_cols: [sample_label, smiles_raw, provenance_file, provenance_sheet, provenance_row]
          value_cols: [usp1_ic50_grade]

  # (E) 조직/민감도/유전형(참고 메타)
  - name: "Table 5"
    tables:
      - id: tissue_sensitivity
        range: "A3:G200"
        header_row_offset: 0
        rename:
          Tissue: tissue
          "Long term proliferation - USP1 inhibitor sensitive? (**<316nM**)": sensitive_longterm
          "Colony Formation Assay - USP1 inhibitor sensitive? (**<316nM**)": sensitive_colony
          BRCA1: brca1
          BRCA2: brca2
          p53: p53
          ATM: atm

  # (F) 용해도/대사 안정성(등급형)
  - name: "Table 6 ~ 7"
    tables:
      - id: table6_solubility
        range: "A3:C240"
        header_row_offset: 0
        rename:
          Sample: sample_id
          "Solubility at pH 2.0 (uM)": solub_pH2_grade
          "Solubility at pH 7.4 (uM)": solub_pH7_grade
        clean:
          replace: {"": null, "-": null}
        normalize_rules:
          solub_pH2_grade:
            - "^'+(.*)$ -> \\1"
          solub_pH7_grade:
            - "^'+(.*)$ -> \\1"
      - id: table7_stability
        range: "E3:G240"
        header_row_offset: 0
        rename:
          Sample: sample_id
          "t_(1/2) (min) in HLM": hlm_t12_grade
          "t_(1/2) (min) in RLM": rlm_t12_grade
        clean:
          replace: {"": null, "-": null}
        normalize_rules:
          hlm_t12_grade:
            - "^'+(.*)$ -> \\1"
          rlm_t12_grade:
            - "^'+(.*)$ -> \\1"

silver:
  compounds:
    from: base/data/bronze/2020/tables/examples.csv
  assays:
    from_melt: usp1_ic50_grades_long
    variable_rules:
      usp1_ic50_grade:
        target_id: usp1
        assay_id: usp1.enzyme.ic50
        parse:
          default_unit: uM
          rules:
            - '^\s*\+\+\+\+\s*$ -> qualifier:<, value:0.01, unit:uM'   # <10 nM
            - '^\s*\+\+\+\s*$   -> qualifier:<, value:0.1,  unit:uM'   # <100 nM
            - '^\s*\+\+\s*$     -> qualifier:<, value:0.2,  unit:uM'   # <200 nM
            - '^\s*\+\s*$       -> qualifier:>, value:0.2,  unit:uM'   # >=200 nM
  meta:
    - from: base/data/bronze/2020/tables/asterisk_exceptions.csv
      type: asterisk_exceptions
    - from: base/data/bronze/2020/tables/tissue_sensitivity.csv
      type: tissue_sensitivity
    - from: base/data/bronze/2020/tables/table6_solubility.csv
      type: solubility_grades
    - from: base/data/bronze/2020/tables/table7_stability.csv
      type: stability_grades
