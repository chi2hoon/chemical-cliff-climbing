file: base/data/bronze/artifacts/2021_raw.xlsx
read: {dtype: str, engine: openpyxl}
sheets:
  # (A) Intermediates (참조용)
  - name: "Intermediate 1~249"
    tables:
      - id: intermediates
        range: "A2:G400"
        header_row_offset: 0
        rename:
          "Compound # ": sample_label
          "Structure (구조) - SMILES": smiles_raw
          Name: name_text
          "Asterik(*) included": flag_asterisk
          Fixed: flag_fixed
          비고: note
        clean:
          replace: {"": null, "-": null}
        flags_from_color:
          - { col_index: 1, map: {"00FFFF": flag_asterisk, "FFFF00": flag_fixed, "FFA500": flag_too_blurry, "FF0000": flag_missing_image, "00FF00": flag_missing_name} }

  # (B) Examples (구조/이름/질량)
  - name: "Example 300~840"
    tables:
      - id: examples
        range: "A2:F900"
        header_row_offset: 0
        rename:
          "Compound # ": compound_id
          "Structure (구조) - SMILES": smiles_raw
          "Name - IUPAC": iupac_name
          "LRMS: (ESI+) m/z": lcms_text
          "Asterik(*) included": flag_asterisk
          비고: note
        clean:
          replace: {"": null, "-": null}
          coerce_string: [iupac_name, lcms_text, note]
        normalize_rules:
          iupac_name:
            - "[\r\n]+ -> ' '"

  # (D) Table 19 (활성; PRMT5 Ki 및 HCT116 IC50)
  - name: "Table 19"
    tables:
      - id: table19
        range: "A2:E900"
        header_row_offset: 0
        rename:
          "Ex. No": ex_no
          "PRMT5 MTase Glo Ki (nM, Meth. A)": ki_a_nM
          "PRMT5 MTase Glo Ki (nM, Meth. B)\t": ki_b_nM
          "ProlifHCTl 16-MTAP null IC_50 (μΜ)        ": ic50_null_uM
          "Prolil_HCTU6-WT IC_50 (μΜ)        ": ic50_wt_uM
        clean:
          replace: {"": null, "-": null}
        normalize_rules:
          ki_a_nM:
            - '^(\\d+)\\s*-\\s*\\.(\\d+)\\s*$ -> \\1.\\2'
          ki_b_nM:
            - '^(\\d+)\\s*-\\s*\\.(\\d+)\\s*$ -> \\1.\\2'
          ic50_null_uM:
            - '^(\\d+)\\s*-\\s*\\.(\\d+)\\s*$ -> \\1.\\2'
          ic50_wt_uM:
            - '^(\\d+)\\s*-\\s*\\.(\\d+)\\s*$ -> \\1.\\2'
        melt:
          id_cols: [ex_no, provenance_file, provenance_sheet, provenance_row]
          value_cols: [ki_a_nM, ki_b_nM, ic50_null_uM, ic50_wt_uM]

silver:
  compounds:
    from: base/data/bronze/2021/tables/examples.csv
  assays:
    from_melt: table19_long
    variable_rules:
      ki_a_nM:
        target_id: prmt5
        assay_id: prmt5.enzyme.ki.A
        parse:
          default_unit: nM
          rules:
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+))\s*(?:nM)?\s*$ -> qualifier:>, value:\1, unit:nM'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+))\s*(?:nM)?\s*$ -> qualifier:=, value:\1, unit:nM'
      ki_b_nM:
        target_id: prmt5
        assay_id: prmt5.enzyme.ki.B
        parse:
          default_unit: nM
          rules:
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+))\s*(?:nM)?\s*$ -> qualifier:>, value:\1, unit:nM'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+))\s*(?:nM)?\s*$ -> qualifier:=, value:\1, unit:nM'
      ic50_null_uM:
        target_id: 'cell:HCT116.MTAP-null'
        assay_id: cell.proliferation.ic50
        parse:
          default_unit: uM
          rules:
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+))\s*µ?M\s*$ -> qualifier:>, value:\1, unit:uM'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+))\s*(?:µ?M)?\s*$ -> qualifier:=, value:\1, unit:uM'
      ic50_wt_uM:
        target_id: 'cell:HCT116.WT'
        assay_id: cell.proliferation.ic50
        parse:
          default_unit: uM
          rules:
            - '>=?\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+))\s*µ?M\s*$ -> qualifier:>, value:\1, unit:uM'
            - '^\s*([+-]?(?:\d+(?:\.\d*)?|\.\d+))\s*(?:µ?M)?\s*$ -> qualifier:=, value:\1, unit:uM'
  meta:
    - from: base/data/bronze/2021/tables/intermediates.csv
      type: intermediates
    - from: base/data/bronze/2021/tables/examples.csv
      type: examples_master
